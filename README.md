# shrv32
暗号アクセラレータなどを搭載したRISC-V，RV32Iと暗号拡張命令を実装．

# RV32Iの実装について
RV32Iに沿って実装してあるが，現在signedとunsignedの区別はしていない．後で実装する．
パイプライン化を考慮して5ステージにした．まだパイプライン化は行なっていない．1命令が終了するのに5クロック必要である．

# 拡張領域について
256ビット演算のため拡張された領域がある．通常の領域とのデータの交換は拡張命令によって行なう．
- 256ビットのレジスタであるreg256を4本を搭載．X[0,3]という名前．なおx0と違いX0はゼロレジスタではない．
- 256ビット用のALUであるexaluを搭載．通常の領域とは異なり各命令が1クロックで終わると限らない，拡張命令が利用するアクセラレータはこのALU内部に搭載される．
  - 例えばAES128の暗号化は10クロック程度，復号化は20クロック程度を要する．
  - 拡張領域が動作している間，通常領域は動作を止める．(複数クロック掛かるため)
- 通常の領域とのデータ共有のためのバスは3つ存在している．
  1. exaluの出力の下位32ビットを通常のレジスタのライトバックに入力するバス
    - r2x命令で利用
  2. 32ビットのレジスタのx[24,31]をその順番で連結してreg256のライトバックに入力するバス
    - x2r命令で利用
  3. exaluの2番入力に対して32ビットのレジスタの2番出力を接続するバス
    - exlb命令にて利用

# 拡張命令について
開発中のため変更の可能性があります．というか汚いのでそのうち整理します．
opcode=0001011 (RV32 custom-0, from Table24.1, risv-spec-20191213)
| 命令          | 定数タイプ | funct3 | オペランド      | 解説                                            | 備考           |
|---------------|------------|--------|-----------------|-------------------------------------------------|----------------|
| aesencrypt128 | R-type     | 1      | xrd, xrs1, xrs2 | xrd = aesencrypt128(plaintext=xrs1,secret=xrs2) | 10クロック必要 |
| aesdecrypt128 | R-type     | 2      | xrd, xrs1, xrs2 | xrd = aesdecrypt128(cipher=xrs1,   secret=xrs2) | 20クロック必要 |
| x2ri          | I-type     | 3      | rd,  xrs1, imm  | rd  = (xrs1>>imm)&0xffffffff                    |                |
| r2x           | I-type     | 4      | xrd             | xrd = x[24,31]                                  | 削除予定       |
| exlb          | I-type     | 5      | xrd, xrs1, imm  | xrd = xr1<<8+[rs1+imm]                          |                |
| x2r           | R-type     | 6      | rd,  xrs1, rs2  | rd  = (xrs1>>rs2)&0xffffffff                    |                |
# UART MMIO
開発中のため変更の可能性があります．
0x200 status register
0x201 Rx buffer
0x202 Tx buffer
0x200 status register mapping
|7          2|1     |0      |
|--not used--|Txbusy|RxReady|
